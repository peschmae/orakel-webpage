<section>
<h2>Workload Hardening Checks</h2>
{{ range .Checks }}
  {{ $whc := . }}
  {{ if .ObjectMeta.OwnerReferences }}
    {{/* Skip if there are owner references */}}
    {{ continue }}
  {{ end }}
  <details name="whc">
    <summary role="button" class="outline">
      {{ if .Successful }}
        <span style="color: green;">&#10004;</span>
      {{ else if .Running  }}
        <span style="color: orange;">&#9888;</span>
      {{ else }}
        <span style="color: red;">&#10008;</span>
      {{ end }}
      {{ .ObjectMeta.Namespace}}/{{ .ObjectMeta.Name }}
    </summary>
    <div class="grid" style="padding-bottom: 20px;">
      <div>
        <strong>Status: </strong>{{ if .Successful }}
          <span style="color: green;">&#10004;</span>
        {{ else if .Running  }}
          <span style="color: orange;">&#9888;</span>
        {{ else }}
          <span style="color: red;">&#10008;</span>
        {{ end }}
      </div>
      <div>
        <strong>Target Reference:</strong> {{ .Spec.TargetRef.Kind }}/{{ .Spec.TargetRef.Name }}
      </div>
      <div>
        <strong>Duration:</strong> {{ .Spec.RecordingDuration }}
      </div>
    </div>

    <section style="width: 80%; margin-left: auto; margin-right: auto;">
      {{ if not .GetRecordings }}
        <p>No recordings available.</p>
      {{ else }}
        <h4>Check Runs</h4>
        {{ range $key, $checkRecording := .GetRecordings }}
        {{ $checkRun := index $whc.Status.CheckRuns $key }}
          <details name="{{ $whc.ObjectMeta.Namespace}}-{{ $whc.ObjectMeta.Name }}-checkruns">
            <summary role="button" class="outline secondary">
              {{ if $checkRun.CheckSuccessfull }}
                <span style="color: green;">&#10004;</span>
              {{ else }}
                <span style="color: red;">&#10008;</span>
              {{ end }}
              {{ $checkRecording.Type }}
            </summary>
            <div class="grid">
              <div>
                <strong>Check: </strong>
                {{ if $checkRun.CheckSuccessfull }}
                  <span style="color: green;">&#10004;</span>
                {{ else }}
                  <span style="color: red;">&#10008;</span>
                {{ end }}
              </div>
              <div>
                <strong>Recording: </strong>
                {{ if $checkRun.RecordingSuccessfull }}
                  <span style="color: green;">&#10004;</span>
                {{ else }}
                  <span style="color: red;">&#10008;</span>
                {{ end }}
              </div>
              <div>
                <strong>CPU: </strong>
                {{ if $checkRun.CpuDeviation }}
                  <span style="color: green;">&#10004;</span>
                {{ else }}
                  <span style="color: red;">&#10008;</span>
                {{ end }}
              </div>
              <div>
                <strong>Memory: </strong>
                {{ if $checkRun.MemoryDeviation }}
                  <span style="color: green;">&#10004;</span>
                {{ else }}
                  <span style="color: red;">&#10008;</span>
                {{ end }}
              </div>
            </div>
            {{ if $checkRun.FailureReason }}
              <p><strong>Failure Reason:</strong> {{ $checkRun.FailureReason }}</p>
            {{ end }}
            {{ if not $checkRun.*CheckSuccessfull }}
              <h5>Log anomalies</h5>
              {{ range $container, $logs := $checkRun.LogAnomalies }}
                <h6>Container: {{ $container }}</h6>
                <pre>{{ $logs | join "\n"}}</pre>
              {{ end }}
            {{ end }}
            <h5>Logs</h5>
            {{ if not $checkRecording.Logs }}
              <p>No logs available.</p>
            {{ else }}
              {{ range $container, $logs := $checkRecording.Logs }}
                <h6>Container: {{ $container }}</h6>
                <pre>{{ $logs | join "\n"}}</pre>
              {{ end }}
            {{ end }}
          </details>
        {{ end }}
      {{ end }}
    </section>
  </details>
{{ end }}
</section>
